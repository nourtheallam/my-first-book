<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Amortized Analysis - course-notes</title>


        <!-- Custom HTML head -->
        <script>
          // MathJax config must be defined before the MathJax script is loaded
          window.MathJax = {
            tex: {
              inlineMath: [['$', '$'], ['\\(', '\\)']],
              displayMath: [['$$', '$$'], ['\\[', '\\]']],
              processEscapes: true
            },
            options: {
              skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'] // ignore code blocks
            }
          };
        </script>
        
        <!-- Load MathJax v3 -->
        <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">course-notes</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="amortized-analysis"><a class="header" href="#amortized-analysis">Amortized Analysis</a></h1>
<h4 id="1-what-is-it"><a class="header" href="#1-what-is-it">1. What is it?</a></h4>
<p><strong>Amortized:</strong> paid-off over time.</p>
<p>The time required to perform a sequence of data structures operations is averaged over all operations performed.</p>
<p>This guarantees the <strong>average</strong> performance of each operation in the <strong>worst case</strong> (meaning, we take the worst case performance of each operation and average the total).</p>
<p>This is ==not the same== as <strong>average case</strong> analysis which relies on some probability distribution of the input while amortized always considers the worst case.</p>
<h4 id="2-why-amortized-analysis"><a class="header" href="#2-why-amortized-analysis">2. Why amortized analysis?</a></h4>
<ul>
<li>Can be used to show that the average cost of an operation is small, even though a single operation can be costly.</li>
<li>Extra flexibility of amortized bounds can lead to more practical data structures.
e.g. <strong>balanced binary search tree</strong> (usually, we need to rebalance the tree after insertion/deletion operations) vs. <strong>splay tree</strong>.</li>
</ul>
<h4 id="3-aggregate-analysis"><a class="header" href="#3-aggregate-analysis">3. Aggregate analysis</a></h4>
<h5 id="steps"><a class="header" href="#steps">Steps</a></h5>
<ol>
<li>Show that for all $n$, a sequence of $n$ operations uses $T(n)$ worst-case time.</li>
<li>The amortized cost per operation is $\frac{T(n)}{n}$.</li>
</ol>
<p>Each operation has the same amortized cost.</p>
<h5 id="example-stack-with-multi-pop"><a class="header" href="#example-stack-with-multi-pop">Example: Stack with multi-pop</a></h5>
<p><strong>Problem:</strong> $MULTIPOP(S, k)$ given the stack $S$, remove its $k$ top objects.</p>
<p><strong>Pseudocode:</strong></p>
<p>While $k \neq 0$ and not $STACK-EMPTY(S)$
do $POP(S)$
$k \leftarrow k-1$</p>
<p><strong>Worst-case analysis:</strong>
PUSH, POP: $O(1)$
MULTIPOP: $O(\min(k,s))$ given that the stack initially contains $s$ elements.</p>
<p><strong>Aggregate Analysis</strong></p>
<p>Analysis of a sequence of $n$ PUSH, POP, and MULTIPOP operations on an <strong>initially empty</strong> stack.</p>
<p>MULTIPOP: $O(n) \rightarrow$ the worst case of any operation is $O(n) \rightarrow$ the total cost of $n$ operations is $O(n^2)$. ==This is not tight!==</p>
<p><strong>Proper analysis:</strong>
Observation: each object can be popped at most once for each time it is pushed.</p>
<p>The number of times POP can be called on an initially-empty stack, including calls within MULTIPOP, is at most the number of PUSH operations $\rightarrow$ which is $O(n)$.</p>
<p>The total cost of $n$ PUSH, POP, MULTIPOP operations on an initially empty stack is $O(n)$.</p>
<p><strong>Amortized cost per operation:</strong> $\frac{O(n)}{n} = O(1)$.</p>
<h5 id="example-incrementing-a-binary-counter"><a class="header" href="#example-incrementing-a-binary-counter">Example: Incrementing a Binary Counter</a></h5>
<p><strong>Problem:</strong> A $k$-bit binary counter that counts upward from $0$. Stored in an array $A[0 \dots k-1]$.</p>
<p><strong>Example:</strong> Let $k=5$, array $=01011$. Incrementing this turns it into $01100$.</p>
<p><strong>Procedure:</strong></p>
<p>==Shows us that the running time is proportional to the number of bit flips.==</p>
<p>INCREMENT($A[0 \dots k-1]$)
i $\rightarrow$ 0
While $i &lt; k$ and $A[i] = 1$
do
$A[i] \rightarrow 0$
$i \rightarrow i+1$
If $i &lt; k$
then $A[i] \rightarrow 1$</p>
<p><strong>Worst-case analysis:</strong>
INCREMENT: $O(k)$
$n$ INCREMENTS: $O(kn)$</p>
<p><strong>Example:</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Value</th><th>A[4]</th><th>A[3]</th><th>A[2]</th><th>A[1]</th><th>A[0]</th></tr></thead><tbody>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td></tr>
<tr><td>2</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td></tr>
<tr><td>3</td><td>0</td><td>0</td><td>1</td><td>1</td><td>1</td></tr>
<tr><td>4</td><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td></tr>
<tr><td><strong>==Observation:==</strong> $A[0]$ flips every time INCREMENT is called, $A[1]$ flips every other time, A[2], flips every third time, etc.</td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td>$\rightarrow$ For $i=0, 1, \dots \lfloor \log n \rfloor$, bit $A[i]$ flips $\lfloor \frac{n}{2^i}\rfloor$ times in a sequence of $n$ INCREMENT operations on an initially $0$ counter.</td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td>$\rightarrow$ For $i &gt; \lfloor \log n \rfloor$, bit $A[i]$ never flips.</td><td></td><td></td><td></td><td></td><td></td></tr>
</tbody></table>
</div>
<p>We can use the above observations to conclude that the total number of bit flips in the sequence of $n$ INCREMENT operations is $$\sum_{i=0}^{\lfloor \log n \rfloor} \left\lfloor \frac{n}{2^i} \right\rfloor &lt; \sum_{i=0}^\infty \frac{n}{2^i} = n\sum_{i=0}^\infty \frac{1}{2^i} = 2n \quad \text{(Geometric series)}$$
<strong>Worst-case analysis:</strong> the worst-case time of a sequence of $n$ INCREMENT operations in thus $O(n)$.</p>
<p><strong>Amortized cost per operation:</strong> $\frac{O(n)}{n} = O(1)$.</p>
<h3 id="3-the-accounting-method"><a class="header" href="#3-the-accounting-method">3. The accounting method</a></h3>
<p><strong>Idea:</strong> We pre-charge a cost for each operation, and we need to make sure that there is enough "credit" for each operation.</p>
<p><strong>Steps:</strong></p>
<ol>
<li>
<p>We charge each operation what we think its amortized time =="cost"== is.</p>
</li>
<li>
<ol>
<li>If the amortized cost exceeds the actual cost, the surplus remains as a =="credit"== associated with the data structure.</li>
<li>If the amortized cost is less than the actual cost, the accumulated credit is used to pay for the cost overflow.</li>
</ol>
<p>$\rightarrow$ To show that the amortized cost is correct, we should ensure that, at all times the total credit associated with the data structure is nonnegative $\iff$ the total amortized cost $\geq$ the total actual cost.</p>
<p>==Why is this enough:== The credit is the difference between the total amortized cost so far, and the total actual cost so far.</p>
</li>
</ol>
<h5 id="example-stack-with-multipop"><a class="header" href="#example-stack-with-multipop">Example: Stack with MULTIPOP</a></h5>
<p>Recall that
<strong>Actual cost:</strong> PUSH is $O(1)$ ($1$ dollar), POP is $O(1)$ ($1$ dollar) and MULTIPOP is $O(\min(k, s))$ ($\min(k, s)$ dollars) where $s$ is the number of items in the stack.</p>
<p>Suppose we assign the following <strong>amortized costs</strong>:
PUSH $\rightarrow$ $2$ dollars
POP $\rightarrow$ $0$ dollars
MULTIPOP $\rightarrow$ $0$ dollars
(resulting in $O(1)$ amortized time).</p>
<p>We start with an empty stack, whose credit is $0$, which is fine because it is nonnegative.</p>
<p>When we PUSH an object into the stack, we charge the operation $2$ dollars. Since this results in an excess cost of $1$, we charge $1$ dollar and use the other as credit. ==We associate this credit with the object we just pushed onto the stack.==</p>
<p>When we POP an object from the stack, we ==thus charge the operation nothing== as we pay its cost using its $1$ dollar credit. Since each object pushed onto the stack is associate with a credit, POP will never make the credit negative.</p>
<p>And the same analysis applies for MULTIPOP$(k,s)$. There are $\min(k,s)$ dollars of credit associated with $\min(k,s)$ objects being popped. Therefore, the total credit of the stack is nonnegative at all times.</p>
<h5 id="example-incrementing-a-binary-counter-1"><a class="header" href="#example-incrementing-a-binary-counter-1">Example: Incrementing a binary counter</a></h5>
<p>The running time of INCREMENT is proportional to the number of bits flipped, and the actual cost of bit flipping is $1$ dollar.</p>
<p>Suppose we charge a bit flip of $0 \rightarrow 1$ an <strong>amortized cost</strong> of $2$ dollars and a bit flip of $1 \rightarrow 0$ a cost of $0$ dollars which we associate with the flipped bit.</p>
<p>Therefore, when we flip $1$ to $0$, we charge $1$ dollar and give that bit $1$ dollar of credit.</p>
<p>Since all the bits are initially $0$s, the total credit of the binary counter is initially $0$ and therefore nonnegative. Moreover, we can conclude that it is nonnegative at all times.</p>
<p>INCREMENT changes at most one $0$ bit to $1$, so ==its amortized cost is at most== $2$, ==which results in $O(1)$!==</p>
<h3 id="4-the-potential-method"><a class="header" href="#4-the-potential-method">4. The Potential Method</a></h3>
<p><strong>Idea:</strong> Instead of credits, we present the prepaid work as ==potential== which can be ==released== to pay for future operations.</p>
<p><strong>What's the difference between this and the credit system?</strong> Potential is a ==function== of the entire data structure.</p>
<p><strong>Steps</strong></p>
<ul>
<li>Let $D_{i}$ be our data structure after the $i$th operation and</li>
<li>Let $\phi(D_{i})$ be the potential of $D_{i}$ and</li>
<li>Let $C_{i}$ be the cost of the $i$th operation</li>
<li>The amortized cost of the $i$th operation $a_{i} = C_{i} + \phi(D_{i}) - \phi(D_{i-1})$</li>
</ul>
<p>$\rightarrow$ $\phi(D_{i}) - \phi(D_{i-1})$ is the change in potential</p>
<p>A correct potential function ensures that the total amortized cost is an upper bound on the total actual cost.</p>
<p>The total amortized cost of $n$ operations is $$\sum_{i=1}^n a_{i} = \sum_{i=1}^n(C_{i} + \phi(D_{i}) - \phi(D_{i-1})) = (\sum_{i=1}^n C_{i}) + \phi(D_{n}) - \phi(D_{0})$$
==Our task now is to define a <strong>potential function</strong> such that==</p>
<ol>
<li>$\phi(D_{0}) = 0$</li>
<li>$\phi(D_{i}) \geq 0$ for all $i$</li>
</ol>
<p>If we achieve, we guarantee the upper bound
$$\sum_{i=1}^n C_{i} = \sum_{i=1}^n a_{i} - \phi(D_{n}) \leq \sum_{i=1}^n a_{i}$$
<strong>Example: Stack with MULTIPOP</strong></p>
<p>We define the potential function $\phi$ on an initially empty stack to be the ==number of objects== in the stack. Therefore, $\phi(D_{0}) = 0$ where $D_{0}$ is the empty stack. This definition also ensures that the potential is always nonnegative as we can never have a negative number of objects in the stack. Moreover, the total amortized cost of $n$ operations with respect to $\phi$ represents an upper bound on the actual cost.</p>
<p>If the stack contains $s$ objects before the $i$th operation, then PUSH leads to a positive change in potential of $1$
$$\phi(D_{i}) - \phi(D_{i-1}) = s + 1 - s = 1$$
And $$a_{i} = C_{i} +1$$
Similar logic applies if we do MULTIPOP with $k' = \min(k, s)$ elements, the change in potential would be $k'$ and the amortized cost of the $i$th operation is $C_{i} - k' = k'- k' = 0$.</p>
<p><mark style="background: #FFB8EBA6;">$C_{i} = k'$ because the actual cost would be at most $k'$ elements popped by multipop. </mark></p>
<p>And with pop, in that case the amortized cost would be $1 - 1 = 0$.</p>
<p><strong>Example: Binary counter</strong></p>
<p>We let $\phi(D_{i})$ be the number of set bits (the number of $1$s). We define this quantity as $b_{i}$.</p>
<p>This potential function is correct because, initially, no bits are set and so $\phi(D_{0}) = 0$. Moreover, it can never be negative as you cannot have a negative number of set bits.</p>
<p>The amortized cost of an INCREMENT operation will depend on the number of $1$s flipped to $0$s. Define this quantity for the $i$th increment as $t_{i}$.</p>
<p>The actual cost of the operation is, therefore, at most $t_{i}+1$.</p>
<p>If $b_{i}$ is $0$, then the $i$th operation sets all $k$ bits from $1$ to $0$. So, $b_{i-1} = t_{i} = k$.</p>
<p>If $b_{i} &gt; 0$, then $b_{i}= b_{i-1} - t_{i} + 1$.</p>
<p>So, in either case, $b_{i} \leq b_{i-1} - t_{i} +1$, and the potential difference is
$$ \begin{aligned} &amp;= b_{i} - b_{i-1} \ &amp;\leq (b_{i} - t_{i} +1)- b_{i-1} \ &amp;= 1 - t_{i} \end{aligned} $$
And the amortized cost is therefore
$$ \begin{aligned} a_{i} &amp;= C_{i} + \phi(D_{i}) - \phi(D_{i-1}) \ &amp;\leq (t_{i}+1)+ (1-t_{i}) \ &amp;= 2 \ &amp;=O(1) \ \end{aligned} $$</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->

                            <a rel="next prefetch" href="Entropy.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

                    <a rel="next prefetch" href="Entropy.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
